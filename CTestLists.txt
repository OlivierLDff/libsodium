#
#   libsodium CTest script
#
#   Copyright Olivier Le Doeuff 2019
#

MACRO(SODIUM_ADD_TEST TEST_NAME)

    SET(TEST_FULL_NAME ${SODIUM_TESTS_PREFIX}_${TEST_NAME})

    MESSAGE(STATUS "Add CTest: ${TEST_FULL_NAME}")

    # Create the executable
    ADD_EXECUTABLE(${TEST_FULL_NAME}
        ${CMAKE_CURRENT_SOURCE_DIR}/test/default/${TEST_NAME}.c
        ${CMAKE_CURRENT_SOURCE_DIR}/test/default/cmptest.h
        ${CMAKE_CURRENT_SOURCE_DIR}/test/quirks/quirks.h
    )

    TARGET_LINK_LIBRARIES(${TEST_FULL_NAME} ${SODIUM_TARGET})
    SET_TARGET_PROPERTIES(${TEST_FULL_NAME} PROPERTIES FOLDER ${SODIUM_FOLDER_PREFIX}/Tests)
    TARGET_INCLUDE_DIRECTORIES(${TEST_FULL_NAME} PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/test/quirks)
    SET(SODIUM_ADDITIONAL_CLEAN_FILES ${SODIUM_ADDITIONAL_CLEAN_FILES} ${TEST_FULL_NAME}.res)

	# Register the test
	ADD_TEST(NAME ${TEST_FULL_NAME}_test
             COMMAND ${TEST_FULL_NAME}
             WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/test/default/
    )

ENDMACRO()

ENABLE_TESTING()

SODIUM_ADD_TEST(aead_aes256gcm)
SODIUM_ADD_TEST(aead_aes256gcm2)
SODIUM_ADD_TEST(aead_chacha20poly1305)
SODIUM_ADD_TEST(aead_chacha20poly13052)
SODIUM_ADD_TEST(aead_xchacha20poly1305)
SODIUM_ADD_TEST(auth)
SODIUM_ADD_TEST(auth2)
SODIUM_ADD_TEST(auth3)
SODIUM_ADD_TEST(auth5)
SODIUM_ADD_TEST(auth6)
SODIUM_ADD_TEST(auth7)
SODIUM_ADD_TEST(box)
SODIUM_ADD_TEST(box2)
SODIUM_ADD_TEST(box7)
SODIUM_ADD_TEST(box8)
SODIUM_ADD_TEST(box_easy)
SODIUM_ADD_TEST(box_easy2)
SODIUM_ADD_TEST(box_seal)
SODIUM_ADD_TEST(box_seed)
SODIUM_ADD_TEST(chacha20)
SODIUM_ADD_TEST(codecs)
SODIUM_ADD_TEST(core1)
SODIUM_ADD_TEST(core2)
SODIUM_ADD_TEST(core3)
SODIUM_ADD_TEST(core4)
SODIUM_ADD_TEST(core5)
SODIUM_ADD_TEST(core6)
SODIUM_ADD_TEST(core_ed25519)
SODIUM_ADD_TEST(core_ristretto255)
SODIUM_ADD_TEST(ed25519_convert)
SODIUM_ADD_TEST(generichash)
SODIUM_ADD_TEST(generichash2)
SODIUM_ADD_TEST(generichash3)
SODIUM_ADD_TEST(hash)
SODIUM_ADD_TEST(hash3)
SODIUM_ADD_TEST(kdf)
SODIUM_ADD_TEST(keygen)
SODIUM_ADD_TEST(metamorphic)
SODIUM_ADD_TEST(misuse)
SODIUM_ADD_TEST(onetimeauth)
SODIUM_ADD_TEST(onetimeauth2)
SODIUM_ADD_TEST(onetimeauth7)
SODIUM_ADD_TEST(pwhash_argon2i)
SODIUM_ADD_TEST(pwhash_argon2id)
SODIUM_ADD_TEST(pwhash_scrypt)
SODIUM_ADD_TEST(pwhash_scrypt_ll)
SODIUM_ADD_TEST(randombytes)
SODIUM_ADD_TEST(scalarmult)
SODIUM_ADD_TEST(scalarmult2)
SODIUM_ADD_TEST(scalarmult5)
SODIUM_ADD_TEST(scalarmult6)
SODIUM_ADD_TEST(scalarmult7)
SODIUM_ADD_TEST(scalarmult8)
SODIUM_ADD_TEST(scalarmult_ed25519)
SODIUM_ADD_TEST(scalarmult_ristretto255)
SODIUM_ADD_TEST(secretbox)
SODIUM_ADD_TEST(secretbox2)
SODIUM_ADD_TEST(secretbox7)
SODIUM_ADD_TEST(secretbox8)
SODIUM_ADD_TEST(secretbox_easy)
SODIUM_ADD_TEST(secretbox_easy2)
SODIUM_ADD_TEST(secretstream)
SODIUM_ADD_TEST(shorthash)
SODIUM_ADD_TEST(sign)
SODIUM_ADD_TEST(siphashx24)
SODIUM_ADD_TEST(sodium_core)
SODIUM_ADD_TEST(sodium_utils)
SODIUM_ADD_TEST(sodium_utils2)
SODIUM_ADD_TEST(sodium_utils3)
SODIUM_ADD_TEST(sodium_version)
SODIUM_ADD_TEST(stream)
SODIUM_ADD_TEST(stream2)
SODIUM_ADD_TEST(stream3)
SODIUM_ADD_TEST(stream4)
SODIUM_ADD_TEST(verify1)
SODIUM_ADD_TEST(xchacha20)

SET_DIRECTORY_PROPERTIES(PROPERTIES ADDITIONAL_MAKE_CLEAN_FILES "${SODIUM_ADDITIONAL_CLEAN_FILES}")